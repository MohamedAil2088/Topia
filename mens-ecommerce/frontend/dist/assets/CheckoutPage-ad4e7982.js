import{e as ie,f as ne,r as a,j as e}from"./react-vendor-f6cd2f28.js";import{u as ce,b as T,a as X,h as le,i as oe}from"./index-93e771d7.js";import{B as S}from"./Button-85468c44.js";import{I as l}from"./Input-b13869b6.js";import{aw as p}from"./vendor-662f24ba.js";const he=()=>{const _=ie(),P=ne(),E=ce(),{items:f,totalPrice:n}=T(t=>t.cart),{userInfo:u}=T(t=>t.auth),[B,I]=a.useState(!1),[m,C]=a.useState(1),[b,L]=a.useState(""),[h,R]=a.useState(""),[j,Y]=a.useState(""),[y,G]=a.useState("Egypt"),[r,$]=a.useState("Card"),[N,U]=a.useState(""),[W,H]=a.useState(""),[D,J]=a.useState(""),[z,K]=a.useState(""),[O,Q]=a.useState(""),[w,Z]=a.useState(0),[ee,te]=a.useState(!1),[v,se]=a.useState(!1);a.useEffect(()=>{const t=P.state;if(t!=null&&t.coupon){const i=Number((n*t.coupon.discount/100).toFixed(2));Z(i),te(!0)}},[P.state,n]);const k=()=>{const t=n>1e3?0:50,i=Number((n*.14).toFixed(2)),o=v?100:0,d=n+t+i+o-w;return Number(d.toFixed(2))},ae=async t=>{var d;const i=(d=t.target.files)==null?void 0:d[0];if(!i)return;const o=new FormData;o.append("image",i);try{const{data:g}=await X.post("/upload",o,{headers:{"Content-Type":"multipart/form-data"}});H(g),p.fire({icon:"success",title:"Receipt Uploaded",text:"Image uploaded successfully!",toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3})}catch{p.fire("Error","Failed to upload image","error")}},re=async()=>{var t,i,o,d,g,q,A,F,M;if(m===1){if(!b||!h||!j||!y){p.fire("Error","Please fill in all shipping details","error");return}C(2);return}if(r==="Card"&&(!D||!z||!O)){p.fire("Error","Please fill in all card details","error");return}if(r==="Vodafone Cash"&&!N){p.fire("Error","Please enter the transaction ID","error");return}I(!0);try{const x=f.filter(s=>s.isCustomOrder),V=f.filter(s=>!s.isCustomOrder);if(x.length>0)for(const s of x){const c={productId:s._id,product:s._id,quantity:s.qty,size:s.size||"M",color:s.color||"Black",customization:{designImages:((t=s.customization)==null?void 0:t.designImages)||[],selectedDesign:((o=(i=s.customization)==null?void 0:i.selectedDesign)==null?void 0:o._id)||null,printLocation:((d=s.customization)==null?void 0:d.printLocation)||"front",printSize:((g=s.customization)==null?void 0:g.printSize)||"medium",specialInstructions:((q=s.customization)==null?void 0:q.specialInstructions)||"",designNotes:((A=s.customization)==null?void 0:A.designNotes)||""},shippingAddress:{street:b,city:h,state:h,zipCode:j,country:y,fullName:(u==null?void 0:u.name)||"Guest",phone:(u==null?void 0:u.phone)||"0000000000"},paymentMethod:r==="Vodafone Cash"?"wallet":r==="Card"?"card":"cash",transactionId:r==="Vodafone Cash"?N:void 0,isPaid:r==="Card",paidAt:r==="Card"?new Date().toISOString():void 0};await X.post("/custom-orders",c)}if(V.length>0){const s={orderItems:V.map(c=>({product:c._id,name:c.name,qty:c.qty,image:c.image,price:c.price,size:c.size,color:c.color})),shippingAddress:{address:b,city:h,postalCode:j,country:y},paymentMethod:r,paymentResult:r==="Vodafone Cash"?{id:N,status:"Pending Verification",receiptImage:W}:r==="Card"?{id:`txn_${Date.now()}`,status:"COMPLETED",update_time:new Date().toISOString()}:void 0,itemsPrice:n,taxPrice:Number((n*.14).toFixed(2)),shippingPrice:n>1e3?0:50,isElitePackaging:v,packagingPrice:v?100:0,discountPrice:w,totalPrice:k()};await E(le(s))}E(oe()),p.fire({icon:"success",title:"Order Placed Successfully!",text:x.length>0?"Your custom orders are being reviewed. We will contact you soon!":"Your order has been confirmed!",confirmButtonText:"View Orders"}).then(()=>{_("/order-success")})}catch(x){console.error(x),p.fire("Error",((M=(F=x.response)==null?void 0:F.data)==null?void 0:M.message)||"Failed to place order","error")}finally{I(!1)}};return f.length===0?e.jsx("div",{className:"p-8 text-center pt-32 font-black uppercase text-gray-400",children:"Your cart is empty"}):e.jsxs("div",{className:"container mx-auto px-4 py-8 pt-40",children:[e.jsxs("h1",{className:"text-4xl font-black font-display mb-2 uppercase italic tracking-tighter",children:["ðŸ”’ Secure ",e.jsx("span",{className:"bg-gradient-to-r from-primary-600 to-purple-600 bg-clip-text text-transparent",children:"Checkout"})]}),e.jsx("p",{className:"text-gray-500 mb-12 uppercase text-[10px] font-bold tracking-[0.2em]",children:"Complete your elite acquisition"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-12",children:[e.jsxs("div",{className:"lg:col-span-8",children:[e.jsxs("div",{className:`mb-12 bg-white p-8 rounded-3xl shadow-sm border border-gray-100 ${m===1?"ring-2 ring-primary-900/5":"opacity-50"}`,children:[e.jsxs("h2",{className:"text-xl font-black mb-8 flex items-center gap-4 uppercase tracking-tighter",children:[e.jsx("span",{className:"w-10 h-10 bg-primary-900 text-white rounded-full flex items-center justify-center text-sm font-black",children:"01"}),"Shipping Details"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(l,{label:"Shipping Address",value:b,onChange:t=>L(t.target.value),required:!0}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(l,{label:"City",value:h,onChange:t=>R(t.target.value),required:!0}),e.jsx(l,{label:"Postal Code",value:j,onChange:t=>Y(t.target.value),required:!0}),e.jsx(l,{label:"Country",value:y,onChange:t=>G(t.target.value),required:!0})]}),m===1&&e.jsx("div",{className:"pt-4",children:e.jsx(S,{onClick:()=>C(2),size:"lg",className:"px-12 rounded-2xl",children:"Continue to Payment"})})]})]}),e.jsxs("div",{className:`mb-8 bg-white p-8 rounded-3xl shadow-sm border border-gray-100 ${m===2?"ring-2 ring-primary-900/5":"opacity-50"}`,children:[e.jsxs("h2",{className:"text-xl font-black mb-8 flex items-center gap-4 uppercase tracking-tighter",children:[e.jsx("span",{className:"w-10 h-10 bg-primary-900 text-white rounded-full flex items-center justify-center text-sm font-black",children:"02"}),"Payment Method"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8",children:["Card","CashOnDelivery","Vodafone Cash"].map(t=>e.jsxs("label",{className:`flex flex-col items-center p-6 border-2 rounded-2xl cursor-pointer transition-all ${r===t?"border-primary-900 bg-primary-50/30":"border-gray-100 hover:border-gray-200"}`,children:[e.jsx("input",{type:"radio",name:"paymentMethod",value:t,checked:r===t,onChange:i=>$(i.target.value),className:"hidden"}),e.jsx("span",{className:"font-black text-[10px] uppercase tracking-widest text-gray-900",children:t})]},t))}),m===2&&e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[r==="Card"&&e.jsxs("div",{className:"p-6 bg-gray-50 border border-gray-200 rounded-2xl space-y-4",children:[e.jsx(l,{label:"Card Number",value:D,onChange:t=>J(t.target.value),placeholder:"0000 0000 0000 0000",required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(l,{label:"Expiry Date",value:z,onChange:t=>K(t.target.value),placeholder:"MM/YY",required:!0}),e.jsx(l,{label:"CVC",value:O,onChange:t=>Q(t.target.value),type:"password",placeholder:"123",required:!0})]})]}),r==="Vodafone Cash"&&e.jsxs("div",{className:"p-6 bg-gray-50 border border-gray-200 rounded-2xl space-y-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 font-medium",children:["Please transfer ",e.jsxs("span",{className:"font-black text-primary-900",children:[k()," EGP"]})," to ",e.jsx("span",{className:"underline font-black",children:"010XXXXXXXX"})]}),e.jsx(l,{label:"Transaction ID",value:N,onChange:t=>U(t.target.value),required:!0}),e.jsx("input",{type:"file",accept:"image/*",onChange:ae,className:"text-sm"})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx(S,{variant:"outline",onClick:()=>C(1),className:"rounded-2xl",children:"Go Back"}),e.jsx(S,{onClick:re,isLoading:B,className:"px-12 rounded-2xl shadow-xl shadow-primary-900/20",children:"Finalize Order"})]})]})]})]}),e.jsx("div",{className:"lg:col-span-4",children:e.jsxs("div",{className:"bg-gray-900 p-8 rounded-[2rem] shadow-2xl text-white sticky top-24",children:[e.jsx("h3",{className:"font-black text-xl uppercase tracking-tighter mb-8",children:"Acquisition Summary"}),e.jsx("div",{className:"space-y-6 mb-8 max-h-[300px] overflow-y-auto pr-2 custom-scrollbar",children:f.map(t=>e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx("div",{className:"w-12 h-16 bg-white/10 rounded-xl overflow-hidden flex-shrink-0",children:e.jsx("img",{src:t.image,alt:t.name,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("h4",{className:"text-xs font-black uppercase tracking-tight",children:t.name}),e.jsxs("p",{className:"text-[10px] text-white/40 font-bold uppercase tracking-widest",children:[t.qty," Ã— ",t.size]}),t.isCustomOrder&&e.jsx("span",{className:"inline-block mt-1 px-2 py-0.5 bg-purple-500/20 text-purple-300 text-[8px] font-bold rounded",children:"ðŸŽ¨ CUSTOM"})]}),e.jsx("div",{className:"text-xs font-black",children:t.price.toFixed(2)})]},t._id))}),e.jsxs("div",{className:"space-y-3 pt-6 border-t border-white/10 text-xs font-bold uppercase tracking-widest text-white/60",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{className:"text-white",children:n.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Handling"}),e.jsx("span",{className:"text-white",children:n>1e3?"Free":"50.00"})]}),e.jsxs("label",{className:"flex items-center justify-between p-3 bg-white/5 rounded-xl border border-white/5 cursor-pointer mt-4 hover:bg-white/10 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:v,onChange:t=>se(t.target.checked),className:"rounded bg-white/10 border-white/20"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-white font-black leading-none",children:"Elite Packaging"}),e.jsx("p",{className:"text-[8px] opacity-40 mt-1",children:"Scented Wax Seal"})]})]}),e.jsx("span",{className:"text-accent-400",children:"+100"})]}),ee&&e.jsxs("div",{className:"flex justify-between text-accent-400",children:[e.jsx("span",{children:"Discount Applied"}),e.jsxs("span",{children:["-",w.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-lg font-black text-white pt-6 border-t border-white/10 mt-6",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:[k()," EGP"]})]})]})]})})]})]})};export{he as default};
